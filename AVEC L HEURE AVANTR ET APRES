#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define MAX 1000
#include <time.h>

typedef struct donnee
{
    char numero[13];
    char nom[30];
    char prenom[30];
    char entsort[8];
    int booleen;
} don;

FILE* chargerfichier(FILE* fichier)
{
    fichier = NULL;
    fichier = fopen("RELEVE TEL.txt","r");
    if(fichier == NULL)
    {
        printf("erreur d'ouverture de fichier.\n");
    }
    return(fichier);
}

void regroup(FILE* fp,don tab[])
{
    fp = chargerfichier(fp);
    for (int i = 0; i<=MAX; i++)
    {
        fscanf(fp, "%s", tab[i].numero);
        fscanf(fp, "%s", tab[i].prenom);
        fscanf(fp, "%s", tab[i].nom);
        fscanf(fp, "%s", tab[i].entsort);
    }
    fclose(fp);
}
int test(char *ch1, char *ch2)
{
    int tmp;
    tmp = strcmp(ch1, ch2);
    return(tmp);
}
void echange(don tab[MAX], int i)
{
    char* tmp = (char*) malloc(15);
    strcpy(tmp, tab[i].numero);
    strcpy(tab[i].numero,tab[i+1].numero);
    strcpy(tab[i+1].numero,tmp);

}

void tribulle(don tab[MAX])
{
    int j, i, tmp;

    for (j=0 ; j < MAX-1; j++)
    {
        for (i=0 ; i < MAX-1; i++)
        {
            tmp = test(tab[i].numero, tab[i+1].numero);
            if(tmp == 1)echange(tab,i);
        }
    }

}

int main()
{
    //Declaration des variables :
    FILE* RELEVE;
    RELEVE = NULL;
    don numeros[MAX];

    //Declaration des variables pour afficher l'heure
    int h, min, s;
    time_t now;

    // Renvoie l'heure actuelle
    time(&now);
    
    // Convertir au format heure locale
    struct tm *local = localtime(&now);
    h = local->tm_hour;
    min = local->tm_min;
    s = local->tm_sec;
    
    RELEVE = chargerfichier(RELEVE);
    regroup(RELEVE, numeros);
    tribulle(numeros);
     
    printf("L'heure avant le tri a bulle : %02d:%02d:%02d\n", h, min, s);

    for(int i =0; i<=MAX; i++)
    {
        printf("%s\n", numeros[i].numero);
    }
    
    time(&now);
    printf("L'heure apres le tri a bulle : %02d:%02d:%02d\n", h, min, s);
    return 0;
}
